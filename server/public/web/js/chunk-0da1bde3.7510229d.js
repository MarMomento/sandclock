(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0da1bde3"],{"755a":function(e,t,n){"use strict";var a=n("7a23"),r=Object(a["T"])("data-v-6ec512a5");Object(a["A"])("data-v-6ec512a5");var i={class:"preview-image"},o={key:1,class:"placeholder"};Object(a["y"])();var c=r((function(e,t,n,r,c,l){var u=Object(a["F"])("v-img");return Object(a["x"])(),Object(a["i"])("div",i,[Object(a["l"])("div",{class:"preview-wrapper",style:{width:e.width,height:e.height}},[e.url?(Object(a["x"])(),Object(a["i"])(u,{key:0,src:e.url,class:"image mw-100"},null,8,["src"])):(Object(a["x"])(),Object(a["i"])("div",o,Object(a["J"])(e.placeholder),1))],4)])})),l=Object(a["m"])({name:"PreviewImage",props:{url:{type:String,required:!0},width:{type:String,default:"100px"},height:{type:String,default:"100px"},placeholder:{type:String,default:"预览图片"}}});n("d5a9");l.render=c,l.__scopeId="data-v-6ec512a5";t["a"]=l},7743:function(e,t,n){"use strict";n.r(t);var a=n("7a23"),r={class:"container article-create-edit-page py-3"},i={class:"row justify-content-center"},o={class:"col-12 col-lg-9"},c={class:"mb-3 fw-bold"},l={class:"row mb-3"},u={class:"col-lg-6 col-12"},s={class:"col-lg-6 col-12"},d={class:"row"},f={class:"col"};function p(e,t,n,p,b,v){var m=Object(a["F"])("v-input"),j=Object(a["F"])("v-form-item"),O=Object(a["F"])("v-select"),g=Object(a["F"])("v-upload"),h=Object(a["F"])("preview-image"),y=Object(a["F"])("v-editor"),w=Object(a["F"])("v-btn"),C=Object(a["F"])("v-form");return Object(a["x"])(),Object(a["i"])("div",r,[Object(a["l"])("div",i,[Object(a["l"])("div",o,[Object(a["l"])("h2",c,Object(a["J"])(e.isEdit?"编辑文章":"创作文章"),1),Object(a["l"])(C,{ref:"articleRef"},{default:Object(a["P"])((function(){return[Object(a["l"])("div",l,[Object(a["l"])("div",u,[Object(a["l"])(j,{label:"文章标题",class:"mb-3"},{default:Object(a["P"])((function(){return[Object(a["l"])(m,{placeholder:"请输入文章标题",modelValue:e.articleInfo.title,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.articleInfo.title=t}),rules:e.titleRules},null,8,["modelValue","rules"])]})),_:1}),Object(a["l"])(j,{label:"文章标签",class:"mb-3"},{default:Object(a["P"])((function(){return[Object(a["l"])(O,{placeholder:"请最多选择4个标签",modelValue:e.articleInfo.tags,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.articleInfo.tags=t}),rules:e.tagRules,items:e.tagItems},null,8,["modelValue","rules","items"])]})),_:1}),Object(a["l"])(j,{label:"文章封面",class:"mb-3"},{default:Object(a["P"])((function(){return[Object(a["l"])(g,{placeholder:"请上传图片",modelValue:e.articleInfo.avatar_url,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.articleInfo.avatar_url=t}),rules:e.checkImg,onUploadSuccess:e.uploadSuccess},null,8,["modelValue","rules","onUploadSuccess"])]})),_:1})]),Object(a["l"])("div",s,[Object(a["l"])(j,{label:"封面预览",class:"mb-3"},{default:Object(a["P"])((function(){return[Object(a["l"])(h,{url:e.articleInfo.avatar_url,width:"100%",height:"230px",placeholder:"预览封面"},null,8,["url"])]})),_:1})])]),Object(a["l"])("div",d,[Object(a["l"])("div",f,[Object(a["l"])(j,{label:"文章内容"},{default:Object(a["P"])((function(){return[Object(a["l"])(y,{placeholder:"请输入文章内容",modelValue:e.articleInfo.content,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.articleInfo.content=t}),rules:e.contentRules},null,8,["modelValue","rules"])]})),_:1})])]),Object(a["l"])(w,{color:"primary mt-3",class:"py-2 px-4",onClick:e.publish},{default:Object(a["P"])((function(){return[Object(a["k"])(Object(a["J"])(e.isEdit?"重新发布":"发布"),1)]})),_:1},8,["onClick"])]})),_:1},512)])])])}var b=n("5530"),v=n("1da1"),m=(n("96cf"),n("d81d"),n("b0c0"),n("6c02")),j={class:"v-editor"},O={key:0,class:"invalid-feedback"};function g(e,t,n,r,i,o){var c=Object(a["F"])("editor");return Object(a["x"])(),Object(a["i"])("div",j,[Object(a["l"])("div",{class:["form-control","p-0",{"is-invalid":e.error}]},[Object(a["l"])(c,Object(a["q"])(e.$attrs,{modelValue:e.val,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.val=t}),apiKey:e.apiKey,init:e.init}),null,16,["modelValue","apiKey","init"])],2),e.message?(Object(a["x"])(),Object(a["i"])("div",O,Object(a["J"])(e.message),1)):Object(a["j"])("",!0)])}var h=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],y=function(e){return-1!==h.map((function(e){return e.toLowerCase()})).indexOf(e.toLowerCase())},w=function(e,t,n){Object.keys(t).filter(y).forEach((function(a){var r=t[a];"function"===typeof r&&("onInit"===a?r(e,n):n.on(a.substring(2),(function(e){return r(e,n)})))}))},C=function(e,t,n,r){var i=e.modelEvents?e.modelEvents:null,o=Array.isArray(i)?i.join(" "):i;Object(a["O"])(r,(function(t,a){n&&"string"===typeof t&&t!==a&&t!==n.getContent({format:e.outputFormat})&&n.setContent(t)})),n.on(o||"change input undo redo",(function(){t.emit("update:modelValue",n.getContent({format:e.outputFormat}))}))},R=function(e,t,n,a,r,i){a.setContent(i()),n.attrs["onUpdate:modelValue"]&&C(t,n,a,r),w(e,n.attrs,a)},S=0,k=function(e){var t=Date.now(),n=Math.floor(1e9*Math.random());return S++,e+"_"+n+S+String(t)},x=function(e){return null!==e&&"textarea"===e.tagName.toLowerCase()},I=function(e){return"undefined"===typeof e||""===e?[]:Array.isArray(e)?e:e.split(" ")},_=function(e,t){return I(e).concat(I(t))},E=function(e){return null===e||void 0===e},V=function(){return{listeners:[],scriptId:k("tiny-script"),scriptLoaded:!1}},A=function(){var e=V(),t=function(e,t,n,a){var r=t.createElement("script");r.referrerPolicy="origin",r.type="application/javascript",r.id=e,r.src=n;var i=function(){r.removeEventListener("load",i),a()};r.addEventListener("load",i),t.head&&t.head.appendChild(r)},n=function(n,a,r){e.scriptLoaded?r():(e.listeners.push(r),n.getElementById(e.scriptId)||t(e.scriptId,n,a,(function(){e.listeners.forEach((function(e){return e()})),e.scriptLoaded=!0})))},a=function(){e=V()};return{load:n,reinitialize:a}},P=A(),F=n("c4a9"),D={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return"html"===e||"text"===e}}},U=function(){return U=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},U.apply(this,arguments)},M=function(e,t,n,a){return e(a||"div",{id:t,ref:n})},K=function(e,t,n){return e("textarea",{id:t,visibility:"hidden",ref:n})},B=Object(a["m"])({props:D,setup:function(e,t){var n=Object(a["K"])(e),r=n.disabled,i=n.modelValue,o=Object(a["C"])(null),c=null,l=e.id||k("tiny-vue"),u=e.init&&e.init.inline||e.inline,s=!!t.attrs["onUpdate:modelValue"],d=!0,f=e.initialValue?e.initialValue:"",p="",b=function(e){return s?function(){return(null===i||void 0===i?void 0:i.value)?i.value:""}:function(){return e?f:p}},v=function(){var n=b(d),a=U(U({},e.init),{readonly:e.disabled,selector:"#"+l,plugins:_(e.init&&e.init.plugins,e.plugins),toolbar:e.toolbar||e.init&&e.init.toolbar,inline:u,setup:function(a){c=a,a.on("init",(function(r){return R(r,e,t,a,i,n)})),e.init&&"function"===typeof e.init.setup&&e.init.setup(a)}});x(o.value)&&(o.value.style.visibility=""),Object(F["a"])().init(a),d=!1};return Object(a["O"])(r,(function(e){null!==c&&c.setMode(e?"readonly":"design")})),Object(a["v"])((function(){if(null!==Object(F["a"])())v();else if(o.value&&o.value.ownerDocument){var t=e.cloudChannel?e.cloudChannel:"5",n=e.apiKey?e.apiKey:"no-api-key",a=E(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+n+"/tinymce/"+t+"/tinymce.min.js":e.tinymceScriptSrc;P.load(o.value.ownerDocument,a,v)}})),Object(a["t"])((function(){null!==Object(F["a"])()&&Object(F["a"])().remove(c)})),u||(Object(a["s"])((function(){d||v()})),Object(a["u"])((function(){var e;s||(p=c.getContent()),null===(e=Object(F["a"])())||void 0===e||e.remove(c)}))),function(){return u?M(a["o"],l,o,e.tagName):K(a["o"],l,o)}}}),L=B,N=n("99e7"),J=n("2de2"),z=n("79f6"),G=Object(a["m"])({name:"VEditor",inheritAttrs:!1,components:{Editor:L},props:{modelValue:{type:String,default:""},rules:{type:Array,default:function(){return[]}}},setup:function(e,t){var n=t.emit,r=Object(a["p"])("form"),i=Object(a["n"])(),o=Object(a["g"])({get:function(){return e.modelValue},set:function(e){n("update:modelValue",e)}}),c=Object(N["a"])(o,e.rules),l=c.state,u=c.validation;Object(a["v"])((function(){null===r||void 0===r||r.register({uid:null===i||void 0===i?void 0:i.uid,validation:u})})),Object(a["w"])((function(){null===r||void 0===r||r.unregister(i)}));var s=Object(a["B"])({language_url:"/tinymce/langs/zh_CN.js",language:"zh_CN",skin_url:"/tinymce/skins/ui/oxide",height:700,branding:!1,menu:{favs:{title:"My Favorites",items:"code visualaid | searchreplace | emoticons"}},menubar:"favs file edit view insert format tools table help",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | codesample | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons | help",plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak","codesample searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","table emoticons template paste help"],default_link_target:"_blank",images_upload_handler:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,n,a){var r,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r=new FormData,r.append("file",t.blob(),t.filename()),e.next=5,Object(z["J"])(r);case 5:i=e.sent,o=i.data,n(o.url),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),a(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));function t(t,n,a){return e.apply(this,arguments)}return t}()});return Object(b["a"])(Object(b["a"])({},Object(a["K"])(l)),{},{init:s,apiKey:J["a"].apiKey})}});G.render=g;var T=G,q=n("7801"),H=n("565a"),Q=n("755a"),X=Object(a["m"])({name:"ArticleCreateAndEdit",components:{VEditor:T,PreviewImage:Q["a"]},setup:function(){var e=Object(m["d"])(),t=Object(m["e"])(),n=Object(a["C"])(e.params.id),r=Object(a["B"])({isEdit:Object(a["g"])((function(){return!!n.value})),articleRef:Object(a["C"])(null),articleInfo:{title:"",content:"",tags:[],avatar_url:""}}),i=Object(a["C"])([]),o=Object(a["g"])((function(){return i.value.map((function(e){return{text:e.name,value:e._id}}))})),c=Object(q["a"])(),l=c.titleRules,u=c.tagRules,s=c.contentRules,d=function(e){var t=e.type;return-1!==t.indexOf("image")||(Object(H["a"])({type:"warn",message:"请上传jpg,jpeg,png格式的文件"}),!1)},f=function(){Object(H["a"])({type:"success",message:"图片上传成功"})},p=function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(z["m"])();case 2:t=e.sent,n=t.data,i.value=n;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(z["e"])(n.value);case 2:t=e.sent,a=t.data,r.articleInfo.title=a.title,r.articleInfo.content=a.content,r.articleInfo.tags=a.tags.map((function(e){return e._id})),r.articleInfo.avatar_url=a.avatar_url;case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){var a,i,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=null===(a=r.articleRef)||void 0===a?void 0:a.validate(),i){e.next=4;break}return Object(H["a"])({type:"warn",message:"请输入正确的数据"}),e.abrupt("return");case 4:if(e.prev=4,!r.isEdit){e.next=11;break}return e.next=8,Object(z["H"])(n.value,r.articleInfo);case 8:Object(H["a"])({type:"success",message:"编辑成功,即将跳转到文章详情页"}),e.next=17;break;case 11:return e.next=13,Object(z["b"])(r.articleInfo);case 13:o=e.sent,c=o.data,n.value=c._id,Object(H["a"])({type:"success",message:"发布成功,即将跳转到文章详情页"});case 17:setTimeout((function(){t.push("/article/".concat(n.value))}),500),e.next=22;break;case 20:e.prev=20,e.t0=e["catch"](4);case 22:case"end":return e.stop()}}),e,null,[[4,20]])})));return function(){return e.apply(this,arguments)}}();Object(a["v"])((function(){p(),n.value&&j()}));var g=function(){n.value="",r.articleInfo={title:"",content:"",tags:[],avatar_url:""}};return Object(m["c"])((function(e,t){"ArticleEdit"===t.name&&"ArticleCreate"===e.name?g():"ArticleCreate"===t.name&&"ArticleEdit"===e.name&&(n.value=e.params.id,j())})),Object(a["s"])((function(){g(),n.value=e.params.id,n.value&&j()})),Object(b["a"])(Object(b["a"])({},Object(a["K"])(r)),{},{tagItems:o,publish:O,titleRules:l,tagRules:u,contentRules:s,checkImg:d,uploadSuccess:f})}});X.render=p;t["default"]=X},7801:function(e,t,n){"use strict";n("aff5"),n("a9e3"),n("99af");var a=n("1e71"),r=function(){var e=[u("用户名")],t=[u("密码")],n=[u("密码")],r=[u("标签"),s(1,4)],i=[u("标题")],o=[u("文章内容")],c=[u("邮箱"),{type:a["a"].EMAIL,message:"请输入合法的邮箱"}],l=[u("搜索内容")];function u(e){return{type:a["a"].REQUIRED,message:"".concat(e,"不能为空")}}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_SAFE_INTEGER;return{type:a["a"].RANGE,message:"数量/长度只能在".concat(e,"-").concat(t),min:e,max:t}}return{nameRules:e,passwordRules:t,againPwdRules:n,tagRules:r,titleRules:i,contentRules:o,emailRules:c,searchRules:l}};t["a"]=r},"8ab3":function(e,t,n){},c4a9:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r}));var a=function(){return"undefined"!==typeof window?window:e},r=function(){var e=a();return e&&e.tinymce?e.tinymce:null}}).call(this,n("c8ba"))},d5a9:function(e,t,n){"use strict";n("8ab3")}}]);
//# sourceMappingURL=chunk-0da1bde3.7510229d.js.map