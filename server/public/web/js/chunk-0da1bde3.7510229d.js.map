{"version":3,"sources":["webpack:///./src/components/PreviewImage.vue","webpack:///./src/components/PreviewImage.vue?6914","webpack:///./src/components/PreviewImage.vue?1fbe","webpack:///./src/views/Article/ArticleCreateAndEdit.vue","webpack:///./src/components/Form/VEditor.vue","webpack:///./node_modules/@tinymce/tinymce-vue/lib/es2015/main/ts/Utils.js","webpack:///./node_modules/@tinymce/tinymce-vue/lib/es2015/main/ts/ScriptLoader.js","webpack:///./node_modules/@tinymce/tinymce-vue/lib/es2015/main/ts/components/EditorPropTypes.js","webpack:///./node_modules/@tinymce/tinymce-vue/lib/es2015/main/ts/components/Editor.js","webpack:///./node_modules/@tinymce/tinymce-vue/lib/es2015/main/ts/index.js","webpack:///./src/components/Form/VEditor.vue?f173","webpack:///./src/components/Form/VEditor.vue?6238","webpack:///./src/views/Article/ArticleCreateAndEdit.vue?c571","webpack:///./src/views/Article/ArticleCreateAndEdit.vue?2017","webpack:///./src/hooks/useRules.ts","webpack:///./node_modules/@tinymce/tinymce-vue/lib/es2015/main/ts/TinyMCE.js","webpack:///./src/components/PreviewImage.vue?c6a8"],"names":["class","style","url","src","placeholder","name","props","type","String","required","width","default","height","render","__scopeId","isEdit","ref","label","articleInfo","title","rules","titleRules","tags","tagRules","items","tagItems","avatar_url","checkImg","uploadSuccess","content","contentRules","color","publish","error","val","apiKey","init","message","validEvents","isValidKey","key","map","event","toLowerCase","indexOf","bindHandlers","initEvent","listeners","editor","Object","keys","filter","forEach","handler","on","substring","e","bindModelHandlers","ctx","modelValue","modelEvents","normalizedEvents","Array","isArray","join","prevVal","getContent","format","outputFormat","setContent","emit","initEditor","attrs","unique","uuid","prefix","time","Date","now","random","Math","floor","isTextarea","element","tagName","normalizePluginArray","plugins","split","mergePlugins","initPlugins","inputPlugins","concat","isNullOrUndefined","value","undefined","createState","scriptId","scriptLoaded","CreateScriptLoader","state","injectScriptTag","doc","callback","scriptTag","createElement","referrerPolicy","id","removeEventListener","addEventListener","head","appendChild","load","push","getElementById","fn","reinitialize","ScriptLoader","editorProps","cloudChannel","initialValue","inline","Boolean","toolbar","disabled","tinymceScriptSrc","validator","prop","__assign","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","renderInline","ce","elementRef","renderIframe","visibility","Editor","setup","_a","vueEditor","elementId","inlineEditor","modelBind","mounting","cache","isMounting","initWrapper","finalInit","readonly","selector","disable","setMode","ownerDocument","channel","scriptSrc","remove","inheritAttrs","components","form","curInstance","inputVal","get","set","newVal","useValidation","validation","register","uid","unregister","language_url","language","skin_url","branding","menu","favs","menubar","default_link_target","images_upload_handler","blobInfo","success","failure","formData","FormData","append","blob","filename","data","config","VEditor","PreviewImage","route","router","params","articleRef","tagList","item","text","_id","useRules","file","getTagList","getArticle","tag","result","validate","setTimeout","resetArticleInfo","to","from","nameRules","REQUIRED","passwordRules","againPwdRules","RANGE","emailRules","EMAIL","searchRules","min","max","Number","MAX_SAFE_INTEGER","getGlobal","window","global","getTinymce","tinymce"],"mappings":"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","file":"js/chunk-0da1bde3.7510229d.js","sourcesContent":["<template>\n  <div class=\"preview-image\">\n    <div\n      class=\"preview-wrapper\"\n      :style=\"{\n        width,\n        height,\n      }\"\n    >\n      <v-img v-if=\"url\" :src=\"url\" class=\"image mw-100\" />\n      <div v-else class=\"placeholder\">{{ placeholder }}</div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"PreviewImage\",\n  props: {\n    url: {\n      type: String,\n      required: true,\n    },\n    width: {\n      type: String,\n      default: \"100px\",\n    },\n    height: {\n      type: String,\n      default: \"100px\",\n    },\n    placeholder: {\n      type: String,\n      default: \"预览图片\",\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.preview-image {\n  .preview-wrapper {\n    border: 2px dashed $gray-500;\n\n    .image {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n    }\n\n    .placeholder {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      color: $gray-500;\n      font-size: 1.3rem;\n    }\n  }\n}\n</style>\n","\nimport { defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"PreviewImage\",\n  props: {\n    url: {\n      type: String,\n      required: true,\n    },\n    width: {\n      type: String,\n      default: \"100px\",\n    },\n    height: {\n      type: String,\n      default: \"100px\",\n    },\n    placeholder: {\n      type: String,\n      default: \"预览图片\",\n    },\n  },\n});\n","import { render } from \"./PreviewImage.vue?vue&type=template&id=6ec512a5&scoped=true\"\nimport script from \"./PreviewImage.vue?vue&type=script&lang=ts\"\nexport * from \"./PreviewImage.vue?vue&type=script&lang=ts\"\n\nimport \"./PreviewImage.vue?vue&type=style&index=0&id=6ec512a5&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-6ec512a5\"\n\nexport default script","<template>\n  <div class=\"container article-create-edit-page py-3\">\n    <div class=\"row justify-content-center\">\n      <div class=\"col-12 col-lg-9\">\n        <h2 class=\"mb-3 fw-bold\">{{ isEdit ? \"编辑文章\" : \"创作文章\" }}</h2>\n        <v-form ref=\"articleRef\">\n          <div class=\"row mb-3\">\n            <div class=\"col-lg-6 col-12\">\n              <v-form-item label=\"文章标题\" class=\"mb-3\">\n                <v-input\n                  placeholder=\"请输入文章标题\"\n                  v-model=\"articleInfo.title\"\n                  :rules=\"titleRules\"\n                />\n              </v-form-item>\n\n              <v-form-item label=\"文章标签\" class=\"mb-3\">\n                <v-select\n                  placeholder=\"请最多选择4个标签\"\n                  v-model=\"articleInfo.tags\"\n                  :rules=\"tagRules\"\n                  :items=\"tagItems\"\n                />\n              </v-form-item>\n\n              <v-form-item label=\"文章封面\" class=\"mb-3\">\n                <v-upload\n                  placeholder=\"请上传图片\"\n                  v-model=\"articleInfo.avatar_url\"\n                  :rules=\"checkImg\"\n                  @upload-success=\"uploadSuccess\"\n                />\n              </v-form-item>\n            </div>\n\n            <div class=\"col-lg-6 col-12\">\n              <v-form-item label=\"封面预览\" class=\"mb-3\">\n                <preview-image\n                  :url=\"articleInfo.avatar_url\"\n                  width=\"100%\"\n                  height=\"230px\"\n                  placeholder=\"预览封面\"\n                />\n              </v-form-item>\n            </div>\n          </div>\n\n          <div class=\"row\">\n            <div class=\"col\">\n              <v-form-item label=\"文章内容\">\n                <v-editor\n                  placeholder=\"请输入文章内容\"\n                  v-model=\"articleInfo.content\"\n                  :rules=\"contentRules\"\n                />\n              </v-form-item>\n            </div>\n          </div>\n\n          <v-btn color=\"primary mt-3\" class=\"py-2 px-4\" @click=\"publish\">\n            {{ isEdit ? \"重新发布\" : \"发布\" }}\n          </v-btn>\n        </v-form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { onBeforeRouteLeave, useRoute, useRouter } from \"vue-router\";\nimport {\n  computed,\n  defineComponent,\n  onActivated,\n  onMounted,\n  reactive,\n  ref,\n  toRefs,\n} from \"vue\";\nimport VEditor from \"@/components/Form/VEditor.vue\";\nimport useRules from \"@/hooks/useRules\";\nimport { ITag } from \"@/typings\";\nimport {\n  createArticle,\n  fetchArticle,\n  fetchPopularTags,\n  updateArticle,\n} from \"@/api\";\nimport $message from \"@/components/Message\";\nimport PreviewImage from \"@/components/PreviewImage.vue\";\n\nexport default defineComponent({\n  name: \"ArticleCreateAndEdit\",\n  components: {\n    VEditor,\n    PreviewImage,\n  },\n  setup() {\n    const route = useRoute();\n    const router = useRouter();\n    const id = ref(route.params.id as string);\n\n    const state = reactive({\n      isEdit: computed(() => (id.value ? true : false)),\n      articleRef: ref<null | HTMLFormElement>(null),\n      articleInfo: {\n        title: \"\",\n        content: \"\",\n        tags: [] as string[],\n        avatar_url: \"\",\n      },\n    });\n    const tagList = ref<ITag[]>([]);\n    const tagItems = computed(() =>\n      tagList.value.map((item) => ({\n        text: item.name,\n        value: item._id,\n      }))\n    );\n    const { titleRules, tagRules, contentRules } = useRules();\n\n    const checkImg = (file: File): boolean => {\n      const type = file.type;\n      if (type.indexOf(\"image\") === -1) {\n        $message({\n          type: \"warn\",\n          message: \"请上传jpg,jpeg,png格式的文件\",\n        });\n        return false;\n      }\n      return true;\n    };\n\n    const uploadSuccess = () => {\n      $message({\n        type: \"success\",\n        message: \"图片上传成功\",\n      });\n    };\n\n    const getTagList = async () => {\n      const { data } = await fetchPopularTags();\n      tagList.value = data;\n    };\n\n    const getArticle = async () => {\n      const { data } = await fetchArticle(id.value);\n      state.articleInfo.title = data.title;\n      state.articleInfo.content = data.content;\n      state.articleInfo.tags = data.tags.map((tag) => tag._id);\n      state.articleInfo.avatar_url = data.avatar_url;\n    };\n\n    const publish = async () => {\n      const result = state.articleRef?.validate();\n      if (!result) {\n        $message({\n          type: \"warn\",\n          message: \"请输入正确的数据\",\n        });\n        return;\n      }\n\n      try {\n        if (state.isEdit) {\n          // republic\n          await updateArticle(id.value, state.articleInfo);\n          $message({\n            type: \"success\",\n            message: \"编辑成功,即将跳转到文章详情页\",\n          });\n        } else {\n          // publish\n          const { data } = await createArticle(state.articleInfo);\n          id.value = data._id;\n          $message({\n            type: \"success\",\n            message: \"发布成功,即将跳转到文章详情页\",\n          });\n        }\n        setTimeout(() => {\n          router.push(`/article/${id.value}`);\n        }, 500);\n      } catch (error) {\n        //\n      }\n    };\n\n    onMounted(() => {\n      getTagList();\n      if (id.value) {\n        getArticle();\n      }\n    });\n\n    const resetArticleInfo = () => {\n      id.value = \"\";\n      state.articleInfo = {\n        title: \"\",\n        content: \"\",\n        tags: [],\n        avatar_url: \"\",\n      };\n    };\n\n    onBeforeRouteLeave((to, from) => {\n      if (from.name === \"ArticleEdit\" && to.name === \"ArticleCreate\") {\n        resetArticleInfo();\n      } else if (from.name === \"ArticleCreate\" && to.name === \"ArticleEdit\") {\n        id.value = to.params.id as string;\n        getArticle();\n      }\n    });\n\n    onActivated(() => {\n      resetArticleInfo();\n      id.value = route.params.id as string;\n      if (id.value) {\n        getArticle();\n      }\n    });\n\n    return {\n      ...toRefs(state),\n      tagItems,\n      publish,\n      titleRules,\n      tagRules,\n      contentRules,\n      checkImg,\n      uploadSuccess,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\" scoped></style>\n","<template>\n  <div class=\"v-editor\">\n    <div :class=\"['form-control', 'p-0', { 'is-invalid': error }]\">\n      <editor v-bind=\"$attrs\" v-model=\"val\" :apiKey=\"apiKey\" :init=\"init\" />\n    </div>\n    <div class=\"invalid-feedback\" v-if=\"message\">{{ message }}</div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  getCurrentInstance,\n  inject,\n  onMounted,\n  onUnmounted,\n  PropType,\n  reactive,\n  toRefs,\n} from \"vue\";\nimport Editor from \"@tinymce/tinymce-vue\";\nimport { IRegistrable, IRule } from \"@/typings\";\nimport useValidation from \"@/hooks/useValidation\";\nimport config from \"@/config/index\";\nimport { uploadImg } from \"@/api\";\n\nexport default defineComponent({\n  name: \"VEditor\",\n  inheritAttrs: false,\n  components: {\n    Editor,\n  },\n  props: {\n    modelValue: {\n      type: String,\n      default: \"\",\n    },\n    rules: {\n      type: Array as PropType<IRule[]>,\n      default: () => [],\n    },\n  },\n  setup(props, { emit }) {\n    const form = inject<IRegistrable>(\"form\");\n    const curInstance = getCurrentInstance();\n    const inputVal = computed({\n      get: () => props.modelValue,\n      set: (newVal) => {\n        emit(\"update:modelValue\", newVal);\n      },\n    });\n\n    const { state, validation } = useValidation(inputVal, props.rules);\n\n    onMounted(() => {\n      form?.register({ uid: curInstance?.uid, validation });\n    });\n\n    onUnmounted(() => {\n      form?.unregister(curInstance);\n    });\n\n    const init = reactive({\n      language_url: \"/tinymce/langs/zh_CN.js\",\n      language: \"zh_CN\",\n      skin_url: \"/tinymce/skins/ui/oxide\",\n      height: 700,\n      branding: false, // 去掉底部状态栏的水印\n      menu: {\n        favs: {\n          title: \"My Favorites\",\n          items: \"code visualaid | searchreplace | emoticons\",\n        },\n      },\n      menubar: \"favs file edit view insert format tools table help\", // 菜单栏\n      // 工具栏\n      toolbar:\n        \"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | \" +\n        \"codesample | bullist numlist outdent indent | link image | print preview media fullpage | \" +\n        \"forecolor backcolor emoticons | help\",\n      // 插件\n      plugins: [\n        \"advlist autolink link image lists charmap print preview hr anchor pagebreak\",\n        \"codesample searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking\",\n        \"table emoticons template paste help\",\n      ],\n      default_link_target: \"_blank\",\n      // 图片上传\n      images_upload_handler: async (\n        blobInfo: any,\n        success: any,\n        failure: any\n      ) => {\n        try {\n          const formData = new FormData();\n          formData.append(\"file\", blobInfo.blob(), blobInfo.filename());\n          const { data } = await uploadImg(formData);\n          success(data.url);\n        } catch (err) {\n          failure(err);\n        }\n      },\n    });\n\n    return {\n      ...toRefs(state),\n      init,\n      apiKey: config.apiKey,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\" scoped></style>\n","/**\n * Copyright (c) 2018-present, Ephox, Inc.\n *\n * This source code is licensed under the Apache 2 license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport { watch } from 'vue';\nvar validEvents = [\n    'onActivate',\n    'onAddUndo',\n    'onBeforeAddUndo',\n    'onBeforeExecCommand',\n    'onBeforeGetContent',\n    'onBeforeRenderUI',\n    'onBeforeSetContent',\n    'onBeforePaste',\n    'onBlur',\n    'onChange',\n    'onClearUndos',\n    'onClick',\n    'onContextMenu',\n    'onCopy',\n    'onCut',\n    'onDblclick',\n    'onDeactivate',\n    'onDirty',\n    'onDrag',\n    'onDragDrop',\n    'onDragEnd',\n    'onDragGesture',\n    'onDragOver',\n    'onDrop',\n    'onExecCommand',\n    'onFocus',\n    'onFocusIn',\n    'onFocusOut',\n    'onGetContent',\n    'onHide',\n    'onInit',\n    'onKeyDown',\n    'onKeyPress',\n    'onKeyUp',\n    'onLoadContent',\n    'onMouseDown',\n    'onMouseEnter',\n    'onMouseLeave',\n    'onMouseMove',\n    'onMouseOut',\n    'onMouseOver',\n    'onMouseUp',\n    'onNodeChange',\n    'onObjectResizeStart',\n    'onObjectResized',\n    'onObjectSelected',\n    'onPaste',\n    'onPostProcess',\n    'onPostRender',\n    'onPreProcess',\n    'onProgressState',\n    'onRedo',\n    'onRemove',\n    'onReset',\n    'onSaveContent',\n    'onSelectionChange',\n    'onSetAttrib',\n    'onSetContent',\n    'onShow',\n    'onSubmit',\n    'onUndo',\n    'onVisualAid'\n];\nvar isValidKey = function (key) { return validEvents.map(function (event) { return event.toLowerCase(); }).indexOf(key.toLowerCase()) !== -1; };\nvar bindHandlers = function (initEvent, listeners, editor) {\n    Object.keys(listeners)\n        .filter(isValidKey)\n        .forEach(function (key) {\n        var handler = listeners[key];\n        if (typeof handler === 'function') {\n            if (key === 'onInit') {\n                handler(initEvent, editor);\n            }\n            else {\n                editor.on(key.substring(2), function (e) { return handler(e, editor); });\n            }\n        }\n    });\n};\nvar bindModelHandlers = function (props, ctx, editor, modelValue) {\n    var modelEvents = props.modelEvents ? props.modelEvents : null;\n    var normalizedEvents = Array.isArray(modelEvents) ? modelEvents.join(' ') : modelEvents;\n    watch(modelValue, function (val, prevVal) {\n        if (editor && typeof val === 'string' && val !== prevVal && val !== editor.getContent({ format: props.outputFormat })) {\n            editor.setContent(val);\n        }\n    });\n    editor.on(normalizedEvents ? normalizedEvents : 'change input undo redo', function () {\n        ctx.emit('update:modelValue', editor.getContent({ format: props.outputFormat }));\n    });\n};\nvar initEditor = function (initEvent, props, ctx, editor, modelValue, content) {\n    editor.setContent(content());\n    if (ctx.attrs['onUpdate:modelValue']) {\n        bindModelHandlers(props, ctx, editor, modelValue);\n    }\n    bindHandlers(initEvent, ctx.attrs, editor);\n};\nvar unique = 0;\nvar uuid = function (prefix) {\n    var time = Date.now();\n    var random = Math.floor(Math.random() * 1000000000);\n    unique++;\n    return prefix + '_' + random + unique + String(time);\n};\nvar isTextarea = function (element) {\n    return element !== null && element.tagName.toLowerCase() === 'textarea';\n};\nvar normalizePluginArray = function (plugins) {\n    if (typeof plugins === 'undefined' || plugins === '') {\n        return [];\n    }\n    return Array.isArray(plugins) ? plugins : plugins.split(' ');\n};\nvar mergePlugins = function (initPlugins, inputPlugins) {\n    return normalizePluginArray(initPlugins).concat(normalizePluginArray(inputPlugins));\n};\nvar isNullOrUndefined = function (value) { return value === null || value === undefined; };\nexport { bindHandlers, bindModelHandlers, initEditor, isValidKey, uuid, isTextarea, mergePlugins, isNullOrUndefined };\n","/**\n * Copyright (c) 2018-present, Ephox, Inc.\n *\n * This source code is licensed under the Apache 2 license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport { uuid } from './Utils';\nvar createState = function () {\n    return {\n        listeners: [],\n        scriptId: uuid('tiny-script'),\n        scriptLoaded: false\n    };\n};\nvar CreateScriptLoader = function () {\n    var state = createState();\n    var injectScriptTag = function (scriptId, doc, url, callback) {\n        var scriptTag = doc.createElement('script');\n        scriptTag.referrerPolicy = 'origin';\n        scriptTag.type = 'application/javascript';\n        scriptTag.id = scriptId;\n        scriptTag.src = url;\n        var handler = function () {\n            scriptTag.removeEventListener('load', handler);\n            callback();\n        };\n        scriptTag.addEventListener('load', handler);\n        if (doc.head) {\n            doc.head.appendChild(scriptTag);\n        }\n    };\n    var load = function (doc, url, callback) {\n        if (state.scriptLoaded) {\n            callback();\n        }\n        else {\n            state.listeners.push(callback);\n            if (!doc.getElementById(state.scriptId)) {\n                injectScriptTag(state.scriptId, doc, url, function () {\n                    state.listeners.forEach(function (fn) { return fn(); });\n                    state.scriptLoaded = true;\n                });\n            }\n        }\n    };\n    // Only to be used by tests.\n    var reinitialize = function () {\n        state = createState();\n    };\n    return {\n        load: load,\n        reinitialize: reinitialize\n    };\n};\nvar ScriptLoader = CreateScriptLoader();\nexport { ScriptLoader };\n","/**\n * Copyright (c) 2018-present, Ephox, Inc.\n *\n * This source code is licensed under the Apache 2 license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nexport var editorProps = {\n    apiKey: String,\n    cloudChannel: String,\n    id: String,\n    init: Object,\n    initialValue: String,\n    inline: Boolean,\n    modelEvents: [String, Array],\n    plugins: [String, Array],\n    tagName: String,\n    toolbar: [String, Array],\n    modelValue: String,\n    disabled: Boolean,\n    tinymceScriptSrc: String,\n    outputFormat: {\n        type: String,\n        validator: function (prop) { return prop === 'html' || prop === 'text'; }\n    },\n};\n","/**\n * Copyright (c) 2018-present, Ephox, Inc.\n *\n * This source code is licensed under the Apache 2 license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { ScriptLoader } from '../ScriptLoader';\nimport { getTinymce } from '../TinyMCE';\nimport { isTextarea, mergePlugins, uuid, isNullOrUndefined, initEditor } from '../Utils';\nimport { editorProps } from './EditorPropTypes';\nimport { h, defineComponent, onMounted, ref, toRefs, watch, onBeforeUnmount, onActivated, onDeactivated } from 'vue';\nvar renderInline = function (ce, id, elementRef, tagName) {\n    return ce(tagName ? tagName : 'div', {\n        id: id,\n        ref: elementRef\n    });\n};\nvar renderIframe = function (ce, id, elementRef) {\n    return ce('textarea', {\n        id: id,\n        visibility: 'hidden',\n        ref: elementRef\n    });\n};\nexport var Editor = defineComponent({\n    props: editorProps,\n    setup: function (props, ctx) {\n        var _a = toRefs(props), disabled = _a.disabled, modelValue = _a.modelValue;\n        var element = ref(null);\n        var vueEditor = null;\n        var elementId = props.id || uuid('tiny-vue');\n        var inlineEditor = (props.init && props.init.inline) || props.inline;\n        var modelBind = !!ctx.attrs['onUpdate:modelValue'];\n        var mounting = true;\n        var initialValue = props.initialValue ? props.initialValue : '';\n        var cache = '';\n        var getContent = function (isMounting) {\n            return modelBind ? function () { return ((modelValue === null || modelValue === void 0 ? void 0 : modelValue.value) ? modelValue.value : ''); }\n                : function () { return isMounting ? initialValue : cache; };\n        };\n        var initWrapper = function () {\n            var content = getContent(mounting);\n            var finalInit = __assign(__assign({}, props.init), { readonly: props.disabled, selector: \"#\" + elementId, plugins: mergePlugins(props.init && props.init.plugins, props.plugins), toolbar: props.toolbar || (props.init && props.init.toolbar), inline: inlineEditor, setup: function (editor) {\n                    vueEditor = editor;\n                    editor.on('init', function (e) { return initEditor(e, props, ctx, editor, modelValue, content); });\n                    if (props.init && typeof props.init.setup === 'function') {\n                        props.init.setup(editor);\n                    }\n                } });\n            if (isTextarea(element.value)) {\n                element.value.style.visibility = '';\n            }\n            getTinymce().init(finalInit);\n            mounting = false;\n        };\n        watch(disabled, function (disable) {\n            if (vueEditor !== null) {\n                vueEditor.setMode(disable ? 'readonly' : 'design');\n            }\n        });\n        onMounted(function () {\n            if (getTinymce() !== null) {\n                initWrapper();\n            }\n            else if (element.value && element.value.ownerDocument) {\n                var channel = props.cloudChannel ? props.cloudChannel : '5';\n                var apiKey = props.apiKey ? props.apiKey : 'no-api-key';\n                var scriptSrc = isNullOrUndefined(props.tinymceScriptSrc) ?\n                    \"https://cdn.tiny.cloud/1/\" + apiKey + \"/tinymce/\" + channel + \"/tinymce.min.js\" :\n                    props.tinymceScriptSrc;\n                ScriptLoader.load(element.value.ownerDocument, scriptSrc, initWrapper);\n            }\n        });\n        onBeforeUnmount(function () {\n            if (getTinymce() !== null) {\n                getTinymce().remove(vueEditor);\n            }\n        });\n        if (!inlineEditor) {\n            onActivated(function () {\n                if (!mounting) {\n                    initWrapper();\n                }\n            });\n            onDeactivated(function () {\n                var _a;\n                if (!modelBind) {\n                    cache = vueEditor.getContent();\n                }\n                (_a = getTinymce()) === null || _a === void 0 ? void 0 : _a.remove(vueEditor);\n            });\n        }\n        return function () {\n            return inlineEditor ?\n                renderInline(h, elementId, element, props.tagName) :\n                renderIframe(h, elementId, element);\n        };\n    }\n});\n","/**\n * Copyright (c) 2018-present, Ephox, Inc.\n *\n * This source code is licensed under the Apache 2 license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport { Editor } from './components/Editor';\nexport default Editor;\n","\nimport {\n  computed,\n  defineComponent,\n  getCurrentInstance,\n  inject,\n  onMounted,\n  onUnmounted,\n  PropType,\n  reactive,\n  toRefs,\n} from \"vue\";\nimport Editor from \"@tinymce/tinymce-vue\";\nimport { IRegistrable, IRule } from \"@/typings\";\nimport useValidation from \"@/hooks/useValidation\";\nimport config from \"@/config/index\";\nimport { uploadImg } from \"@/api\";\n\nexport default defineComponent({\n  name: \"VEditor\",\n  inheritAttrs: false,\n  components: {\n    Editor,\n  },\n  props: {\n    modelValue: {\n      type: String,\n      default: \"\",\n    },\n    rules: {\n      type: Array as PropType<IRule[]>,\n      default: () => [],\n    },\n  },\n  setup(props, { emit }) {\n    const form = inject<IRegistrable>(\"form\");\n    const curInstance = getCurrentInstance();\n    const inputVal = computed({\n      get: () => props.modelValue,\n      set: (newVal) => {\n        emit(\"update:modelValue\", newVal);\n      },\n    });\n\n    const { state, validation } = useValidation(inputVal, props.rules);\n\n    onMounted(() => {\n      form?.register({ uid: curInstance?.uid, validation });\n    });\n\n    onUnmounted(() => {\n      form?.unregister(curInstance);\n    });\n\n    const init = reactive({\n      language_url: \"/tinymce/langs/zh_CN.js\",\n      language: \"zh_CN\",\n      skin_url: \"/tinymce/skins/ui/oxide\",\n      height: 700,\n      branding: false, // 去掉底部状态栏的水印\n      menu: {\n        favs: {\n          title: \"My Favorites\",\n          items: \"code visualaid | searchreplace | emoticons\",\n        },\n      },\n      menubar: \"favs file edit view insert format tools table help\", // 菜单栏\n      // 工具栏\n      toolbar:\n        \"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | \" +\n        \"codesample | bullist numlist outdent indent | link image | print preview media fullpage | \" +\n        \"forecolor backcolor emoticons | help\",\n      // 插件\n      plugins: [\n        \"advlist autolink link image lists charmap print preview hr anchor pagebreak\",\n        \"codesample searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking\",\n        \"table emoticons template paste help\",\n      ],\n      default_link_target: \"_blank\",\n      // 图片上传\n      images_upload_handler: async (\n        blobInfo: any,\n        success: any,\n        failure: any\n      ) => {\n        try {\n          const formData = new FormData();\n          formData.append(\"file\", blobInfo.blob(), blobInfo.filename());\n          const { data } = await uploadImg(formData);\n          success(data.url);\n        } catch (err) {\n          failure(err);\n        }\n      },\n    });\n\n    return {\n      ...toRefs(state),\n      init,\n      apiKey: config.apiKey,\n    };\n  },\n});\n","import { render } from \"./VEditor.vue?vue&type=template&id=c2577f78\"\nimport script from \"./VEditor.vue?vue&type=script&lang=ts\"\nexport * from \"./VEditor.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\nimport { onBeforeRouteLeave, useRoute, useRouter } from \"vue-router\";\nimport {\n  computed,\n  defineComponent,\n  onActivated,\n  onMounted,\n  reactive,\n  ref,\n  toRefs,\n} from \"vue\";\nimport VEditor from \"@/components/Form/VEditor.vue\";\nimport useRules from \"@/hooks/useRules\";\nimport { ITag } from \"@/typings\";\nimport {\n  createArticle,\n  fetchArticle,\n  fetchPopularTags,\n  updateArticle,\n} from \"@/api\";\nimport $message from \"@/components/Message\";\nimport PreviewImage from \"@/components/PreviewImage.vue\";\n\nexport default defineComponent({\n  name: \"ArticleCreateAndEdit\",\n  components: {\n    VEditor,\n    PreviewImage,\n  },\n  setup() {\n    const route = useRoute();\n    const router = useRouter();\n    const id = ref(route.params.id as string);\n\n    const state = reactive({\n      isEdit: computed(() => (id.value ? true : false)),\n      articleRef: ref<null | HTMLFormElement>(null),\n      articleInfo: {\n        title: \"\",\n        content: \"\",\n        tags: [] as string[],\n        avatar_url: \"\",\n      },\n    });\n    const tagList = ref<ITag[]>([]);\n    const tagItems = computed(() =>\n      tagList.value.map((item) => ({\n        text: item.name,\n        value: item._id,\n      }))\n    );\n    const { titleRules, tagRules, contentRules } = useRules();\n\n    const checkImg = (file: File): boolean => {\n      const type = file.type;\n      if (type.indexOf(\"image\") === -1) {\n        $message({\n          type: \"warn\",\n          message: \"请上传jpg,jpeg,png格式的文件\",\n        });\n        return false;\n      }\n      return true;\n    };\n\n    const uploadSuccess = () => {\n      $message({\n        type: \"success\",\n        message: \"图片上传成功\",\n      });\n    };\n\n    const getTagList = async () => {\n      const { data } = await fetchPopularTags();\n      tagList.value = data;\n    };\n\n    const getArticle = async () => {\n      const { data } = await fetchArticle(id.value);\n      state.articleInfo.title = data.title;\n      state.articleInfo.content = data.content;\n      state.articleInfo.tags = data.tags.map((tag) => tag._id);\n      state.articleInfo.avatar_url = data.avatar_url;\n    };\n\n    const publish = async () => {\n      const result = state.articleRef?.validate();\n      if (!result) {\n        $message({\n          type: \"warn\",\n          message: \"请输入正确的数据\",\n        });\n        return;\n      }\n\n      try {\n        if (state.isEdit) {\n          // republic\n          await updateArticle(id.value, state.articleInfo);\n          $message({\n            type: \"success\",\n            message: \"编辑成功,即将跳转到文章详情页\",\n          });\n        } else {\n          // publish\n          const { data } = await createArticle(state.articleInfo);\n          id.value = data._id;\n          $message({\n            type: \"success\",\n            message: \"发布成功,即将跳转到文章详情页\",\n          });\n        }\n        setTimeout(() => {\n          router.push(`/article/${id.value}`);\n        }, 500);\n      } catch (error) {\n        //\n      }\n    };\n\n    onMounted(() => {\n      getTagList();\n      if (id.value) {\n        getArticle();\n      }\n    });\n\n    const resetArticleInfo = () => {\n      id.value = \"\";\n      state.articleInfo = {\n        title: \"\",\n        content: \"\",\n        tags: [],\n        avatar_url: \"\",\n      };\n    };\n\n    onBeforeRouteLeave((to, from) => {\n      if (from.name === \"ArticleEdit\" && to.name === \"ArticleCreate\") {\n        resetArticleInfo();\n      } else if (from.name === \"ArticleCreate\" && to.name === \"ArticleEdit\") {\n        id.value = to.params.id as string;\n        getArticle();\n      }\n    });\n\n    onActivated(() => {\n      resetArticleInfo();\n      id.value = route.params.id as string;\n      if (id.value) {\n        getArticle();\n      }\n    });\n\n    return {\n      ...toRefs(state),\n      tagItems,\n      publish,\n      titleRules,\n      tagRules,\n      contentRules,\n      checkImg,\n      uploadSuccess,\n    };\n  },\n});\n","import { render } from \"./ArticleCreateAndEdit.vue?vue&type=template&id=6db134c0\"\nimport script from \"./ArticleCreateAndEdit.vue?vue&type=script&lang=ts\"\nexport * from \"./ArticleCreateAndEdit.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { IRule, RULE_TYPE } from \"@/typings\";\n\n/**\n * 表单输入校验规则\n */\n\nconst useRules = () => {\n  const nameRules = [REQUIRED(\"用户名\")];\n  const passwordRules = [REQUIRED(\"密码\")];\n  const againPwdRules = [REQUIRED(\"密码\")];\n  const tagRules = [REQUIRED(\"标签\"), RANGE(1, 4)];\n  const titleRules = [REQUIRED(\"标题\")];\n  const contentRules = [REQUIRED(\"文章内容\")];\n  const emailRules = [\n    REQUIRED(\"邮箱\"),\n    { type: RULE_TYPE.EMAIL, message: \"请输入合法的邮箱\" },\n  ];\n  const searchRules = [REQUIRED(\"搜索内容\")];\n\n  function REQUIRED(prefix: string): IRule {\n    return {\n      type: RULE_TYPE.REQUIRED,\n      message: `${prefix}不能为空`,\n    };\n  }\n\n  function RANGE(min = 0, max = Number.MAX_SAFE_INTEGER): IRule {\n    return {\n      type: RULE_TYPE.RANGE,\n      message: `数量/长度只能在${min}-${max}`,\n      min,\n      max,\n    };\n  }\n\n  return {\n    nameRules,\n    passwordRules,\n    againPwdRules,\n    tagRules,\n    titleRules,\n    contentRules,\n    emailRules,\n    searchRules,\n  };\n};\n\nexport default useRules;\n","/**\n * Copyright (c) 2018-present, Ephox, Inc.\n *\n * This source code is licensed under the Apache 2 license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nvar getGlobal = function () { return (typeof window !== 'undefined' ? window : global); };\nvar getTinymce = function () {\n    var global = getGlobal();\n    return global && global.tinymce ? global.tinymce : null;\n};\nexport { getTinymce };\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./PreviewImage.vue?vue&type=style&index=0&id=6ec512a5&lang=scss&scoped=true\""],"sourceRoot":""}